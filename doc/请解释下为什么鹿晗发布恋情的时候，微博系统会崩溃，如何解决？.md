## 请解释下为什么鹿晗发布恋情的时候，微博系统会崩溃，如何解决？

**为什么会崩溃？**

因为明星效应，鹿晗发布微博后，有大量的用户在同一个时间段内都会搜索这一条微博。首先发布的微博会写入到DB中，如果全部查询DB肯定把MySQL打挂了，所以会做一层缓存，鹿晗发布的微博会写在缓存里，大量的用户会查询这个缓存数据。

缓存也不是银弹，也可能会存在几个问题可能导致服务崩溃：

(1) 缓存击穿。缓存失效时，这一瞬间所有的请求都会打到DB上，直接导致DB处理不过来而崩溃，从而导致整个服务崩溃。

(2) 热点数据。所有的用户都查询的是鹿晗发布的这一条微博，也就是都要命中缓存中的同一个KEY。所有请求都会路由到同一台缓存机器上，过大的并发导致机器宕机。

**怎么解决？**

缓存击穿：加锁

热点数据：通过大数据流式计算自动发现热点数据，将发现的热点数据上报配置中心，业务方根据配置中的热点数据信息，分配多个实例存储热点KEY